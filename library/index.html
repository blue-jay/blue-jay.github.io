<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <title>Library - Blue Jay</title>
    <meta name="generator" content="Hugo 0.15" />

    
    <meta name="description" content="Blue Jay is a toolkit written in Go for the web.">
    
    <link rel="canonical" href="http://blue-jay.github.io/library/">
    
    <meta name="author" content="Joseph Spurrier">
    

    <meta property="og:url" content="http://blue-jay.github.io/library/">
    <meta property="og:title" content="Blue Jay">
    <meta property="og:image" content="http://blue-jay.github.io/images/bluejaylogo.png">
    <meta name="apple-mobile-web-app-title" content="Blue Jay">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="http://blue-jay.github.io/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="http://blue-jay.github.io/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('http://blue-jay.github.io/fonts/icon.eot?52m981');
        src: url('http://blue-jay.github.io/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('http://blue-jay.github.io/fonts/icon.woff?52m981')
               format('woff'),
             url('http://blue-jay.github.io/fonts/icon.ttf?52m981')
               format('truetype'),
             url('http://blue-jay.github.io/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="http://blue-jay.github.io/stylesheets/application.css">
    <link rel="stylesheet" href="http://blue-jay.github.io/stylesheets/palettes.css">
    <link rel="stylesheet" href="http://blue-jay.github.io/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu%2bMono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>
    
    
    <link rel="stylesheet" href="http://blue-jay.github.io/stylesheets/global.css">
    
    <link rel="stylesheet" href="http://blue-jay.github.io/stylesheets/colors.css">
    
    <script src="http://blue-jay.github.io/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-jayblue palette-accent-amber">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Library
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/blue-jay" title="@blue-jay on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/blue-jay/blueprint" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="http://blue-jay.github.io/images/bluejaylogo.png">
        </div>
      
      <div class="name">
        <strong>Blue Jay <span class="version">0.5-bravo</span></strong>
        
          <br>
          blue-jay/blueprint
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/blue-jay/blueprint/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/blue-jay/blueprint/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Toolkit Overview" href="http://blue-jay.github.io/">
	
	Toolkit Overview
</a>


  
</li>



<li>
  
    



<a  title="Structure" href="http://blue-jay.github.io/structure/">
	
	Structure
</a>


  
</li>



<li>
  
    



<a  title="Configuration" href="http://blue-jay.github.io/configuration/">
	
	Configuration
</a>


  
</li>



<li>
  
    



<a  title="Assets" href="http://blue-jay.github.io/assets/">
	
	Assets
</a>


  
</li>



<li>
  
    



<a  title="Routing" href="http://blue-jay.github.io/routing/">
	
	Routing
</a>


  
</li>



<li>
  
    



<a  title="Middleware" href="http://blue-jay.github.io/middleware/">
	
	Middleware
</a>


  
</li>



<li>
  
    



<a  title="Controllers" href="http://blue-jay.github.io/controllers/">
	
	Controllers
</a>


  
</li>



<li>
  
    



<a  title="Models" href="http://blue-jay.github.io/models/">
	
	Models
</a>


  
</li>



<li>
  
    



<a  title="Views" href="http://blue-jay.github.io/views/">
	
	Views
</a>


  
</li>



<li>
  
    



<a class="current" title="Library" href="http://blue-jay.github.io/library/">
	
	Library
</a>


<ul id="scrollspy">
</ul>

  
</li>



<li>
  
    



<a  title="Jay Overview" href="http://blue-jay.github.io/jay/">
	
	Jay Overview
</a>


  
</li>



<li>
  
    



<a  title="Find and Replace" href="http://blue-jay.github.io/find-replace/">
	
	Find and Replace
</a>


  
</li>



<li>
  
    



<a  title="Database Migration" href="http://blue-jay.github.io/database-migration/">
	
	Database Migration
</a>


  
</li>



<li>
  
    



<a  title="Code Generation" href="http://blue-jay.github.io/generation/">
	
	Code Generation
</a>


  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/blue-jay" target="_blank" title="@blue-jay on GitHub">
              @blue-jay on GitHub
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Library </h1>

			

<h2 id="basic-usage">Basic Usage</h2>

<p>If you look through the <strong>lib</strong> folder, you&rsquo;ll see packages that provide
different functionality. These packages are designed to be shared and used
through the application. Since Blueprint is a web application, the packages
must be thread-safe to ensure they won&rsquo;t throw any errors if they are accessed
at the same time by two separate threads.</p>

<p>It&rsquo;s a good idea to keep them light on dependencies so you can reuse them again
in later projects. Packages that are too tightly-coupled require time to rework
so you might as well do it right from the start.</p>

<p>Let&rsquo;s take a look at the <strong>lib/email</strong> package in sections. The first of the
three sections is the package declaration and import section. Notice how the
only packages the <strong>email</strong> package uses are part of the standard library. This
is a good indicator that the package could be moved to a different project
without rewriting.</p>

<pre><code class="language-go">// Package email provides email sending via SMTP.
package email

import (
    &quot;encoding/base64&quot;
    &quot;fmt&quot;
    &quot;net/smtp&quot;
    &quot;sync&quot;
)
</code></pre>

<p>The next section shows the thread-safe configuration that is used in many of
the lib packages. The Info struct holds the details for the SMTP server and is
public so it can be nested in the <strong>Info</strong> struct of the <strong>bootstrap</strong> package
and then parsed from the env.json file. See the <a href="http://blue-jay.github.io/configuration/">Configuration</a>
section for more information about adding to env.json.</p>

<p>There are also a few methods standard to the lib packages:</p>

<ul>
<li>SetConfig() - allows the <strong>bootstrap</strong> package to store the Info struct to a package level variable</li>
<li>ResetConfig() - allows test packages to reset the configuration</li>
<li>Config() - returns the configuration so the values can be accessed by other packages</li>
</ul>

<p>All of these methods are thread-safe so they can be called by external packages
and by the functions within the package itself.</p>

<pre><code class="language-go">// *****************************************************************************
// Thread-Safe Configuration
// *****************************************************************************

var (
    info      Info
    infoMutex sync.RWMutex
)

// Info holds the details for the SMTP server.
type Info struct {
    Username string
    Password string
    Hostname string
    Port     int
    From     string
}

// SetConfig stores the config.
func SetConfig(i Info) {
    infoMutex.Lock()
    info = i
    infoMutex.Unlock()
}

// ResetConfig removes the config.
func ResetConfig() {
    infoMutex.Lock()
    info = Info{}
    infoMutex.Unlock()
}

// Config returns the config.
func Config() Info {
    infoMutex.RLock()
    defer infoMutex.RUnlock()
    return info
}
</code></pre>

<p>The final section of the <strong>email</strong> package contains the ability to send an
email using the configuration settings. You&rsquo;ll notice the <strong>Config()</strong> function
through the code. This ensures the values are accessed in a thread-safe manner
so there is no problem if another package tries to change a value at the same
time.</p>

<pre><code class="language-go">// Send mails an email.
func Send(to, subject, body string) error {
    auth := smtp.PlainAuth(&quot;&quot;, Config().Username, Config().Password, Config().Hostname)

    header := make(map[string]string)
    header[&quot;From&quot;] = Config().From
    header[&quot;To&quot;] = to
    header[&quot;Subject&quot;] = subject
    header[&quot;MIME-Version&quot;] = &quot;1.0&quot;
    header[&quot;Content-Type&quot;] = `text/plain; charset=&quot;utf-8&quot;`
    header[&quot;Content-Transfer-Encoding&quot;] = &quot;base64&quot;

    message := &quot;&quot;
    for k, v := range header {
        message += fmt.Sprintf(&quot;%s: %s\r\n&quot;, k, v)
    }
    message += &quot;\r\n&quot; + base64.StdEncoding.EncodeToString([]byte(body))

    // Send the email
    err := smtp.SendMail(
        fmt.Sprintf(&quot;%s:%d&quot;, Config().Hostname, Config().Port),
        auth,
        Config().From,
        []string{to},
        []byte(message),
    )

    return err
}
</code></pre>

<h2 id="code-generation">Code Generation</h2>

<p>A new <strong>lib</strong> package can be generated with the thread-safe configuration using
this command: <code>jay generate lib/default package:value</code></p>

			
			<aside class="copyright" role="note">
				
				&copy; 2016 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">
					Material
				</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="http://blue-jay.github.io/views/" title="Views">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Views
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="http://blue-jay.github.io/jay/" title="Jay Overview">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Jay Overview
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'http:\/\/blue-jay.github.io\/';
      var repo_id  = 'blue-jay\/blueprint';
    
    </script>

    <script src="http://blue-jay.github.io/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(headers.length > 0) {
        for(var i = 0; i < headers.length; i++) {
          var li = document.createElement("li");
          li.setAttribute("class", "anchor");

          var a  = document.createElement("a");
          a.setAttribute("href", "#" + headers[i].id);
          a.setAttribute("title", headers[i].innerHTML);
          a.innerHTML = headers[i].innerHTML;
          
          li.appendChild(a)
          scrollspy.appendChild(li);
        }
      } else {
        scrollspy.parentElement.removeChild(scrollspy)
      }
      

      /* Add permanent link next to the headers */
      var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

      for(var i = 0; i < headers.length; i++) {
          var a = document.createElement("a");
          a.setAttribute("class", "headerlink");
          a.setAttribute("href", "#" + headers[i].id);
          a.setAttribute("title", "Permanent link")
          a.innerHTML = "#";
          headers[i].appendChild(a);
      }
    </script>

    

    <script src="//gohugo.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
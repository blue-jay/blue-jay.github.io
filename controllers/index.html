<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <title>Controllers - Blue Jay | Go Toolkit for the Web</title>
    <meta name="generator" content="Hugo 0.15" />

    
    <meta name="description" content="Blue Jay is a toolkit written in Go for the web.">
    
    <link rel="canonical" href="http://blue-jay.github.io/controllers/">
    
    <meta name="author" content="Joseph Spurrier">
    

    <meta property="og:url" content="http://blue-jay.github.io/controllers/">
    <meta property="og:title" content="Blue Jay | Go Toolkit for the Web">
    <meta property="og:image" content="http://blue-jay.github.io/images/bluejaylogo.png">
    <meta name="apple-mobile-web-app-title" content="Blue Jay | Go Toolkit for the Web">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="http://blue-jay.github.io/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="http://blue-jay.github.io/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('http://blue-jay.github.io/fonts/icon.eot?52m981');
        src: url('http://blue-jay.github.io/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('http://blue-jay.github.io/fonts/icon.woff?52m981')
               format('woff'),
             url('http://blue-jay.github.io/fonts/icon.ttf?52m981')
               format('truetype'),
             url('http://blue-jay.github.io/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="http://blue-jay.github.io/stylesheets/application.css">
    <link rel="stylesheet" href="http://blue-jay.github.io/stylesheets/palettes.css">
    <link rel="stylesheet" href="http://blue-jay.github.io/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu%2bMono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>
    
    
    <link rel="stylesheet" href="http://blue-jay.github.io/stylesheets/global.css">
    
    <link rel="stylesheet" href="http://blue-jay.github.io/stylesheets/colors.css">
    
    <script src="http://blue-jay.github.io/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-jayblue palette-accent-amber">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Controller
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/blue-jay" title="@blue-jay on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/blue-jay/blueprint" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="http://blue-jay.github.io/images/bluejaylogo.png">
        </div>
      
      <div class="name">
        <br><strong>blue-jay/blueprint</strong>
        <br><span class="version">0.8-delta</span>
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/blue-jay/blueprint" target="_blank" title="View Github">
              <i class="icon icon-github"></i> GitHub
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/blue-jay/blueprint/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Blue Jay Overview" href="http://blue-jay.github.io/">
	
	Blue Jay Overview
</a>


  
</li>



<li>
  
    



<a  title="Structure" href="http://blue-jay.github.io/structure/">
	
	Structure
</a>


  
</li>



<li>
  
    



<a  title="Configuration" href="http://blue-jay.github.io/configuration/">
	
	Configuration
</a>


  
</li>



<li>
  
    



<a  title="Assets" href="http://blue-jay.github.io/assets/">
	
	Assets
</a>


  
</li>



<li>
  
    



<a  title="Routing" href="http://blue-jay.github.io/routing/">
	
	Routing
</a>


  
</li>



<li>
  
    



<a  title="Middleware" href="http://blue-jay.github.io/middleware/">
	
	Middleware
</a>


  
</li>



<li>
  
    



<a class="current" title="Controllers" href="http://blue-jay.github.io/controllers/">
	
	Controllers
</a>


<ul id="scrollspy">
</ul>

  
</li>



<li>
  
    



<a  title="Models" href="http://blue-jay.github.io/models/">
	
	Models
</a>


  
</li>



<li>
  
    



<a  title="Views" href="http://blue-jay.github.io/views/">
	
	Views
</a>


  
</li>



<li>
  
    



<a  title="Library" href="http://blue-jay.github.io/library/">
	
	Library
</a>


  
</li>



<li>
  
    



<a  title="Jay Overview" href="http://blue-jay.github.io/jay/">
	
	Jay Overview
</a>


  
</li>



<li>
  
    



<a  title="Find and Replace" href="http://blue-jay.github.io/find-replace/">
	
	Find and Replace
</a>


  
</li>



<li>
  
    



<a  title="Database Migration" href="http://blue-jay.github.io/database-migration/">
	
	Database Migration
</a>


  
</li>



<li>
  
    



<a  title="Code Generation" href="http://blue-jay.github.io/generation/">
	
	Code Generation
</a>


  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/blue-jay" target="_blank" title="@blue-jay on GitHub">
              @blue-jay on GitHub
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Controllers </h1>

			

<h2 id="basic-usage">Basic Usage</h2>

<p>The controller files are all organized under the <strong>controller</strong> folder. The
controllers handle the interactions between the models and the views as well as
specify which routes to map to which functions.</p>

<p>It&rsquo;s a good idea to follow a naming convention for the different pieces.
Laravel developers will notice it&rsquo;s very similar, but with a few changes.</p>

<table>
<thead>
<tr>
<th align="center">Method</th>
<th align="center">Path</th>
<th align="center">Function</th>
<th align="center">View</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">GET</td>
<td align="center">/notepad</td>
<td align="center">Index</td>
<td align="center">index.tmpl</td>
</tr>

<tr>
<td align="center">GET</td>
<td align="center">/notepad/create</td>
<td align="center">Create</td>
<td align="center">create.tmpl</td>
</tr>

<tr>
<td align="center">POST</td>
<td align="center">/notepad/create</td>
<td align="center">Store</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">GET</td>
<td align="center">/notepad/view/:id</td>
<td align="center">Show</td>
<td align="center">show.tmpl</td>
</tr>

<tr>
<td align="center">GET</td>
<td align="center">/notepad/edit/:id</td>
<td align="center">Edit</td>
<td align="center">edit.tmpl</td>
</tr>

<tr>
<td align="center">PATCH</td>
<td align="center">/notepad/edit/:id</td>
<td align="center">Update</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">DELETE</td>
<td align="center">/notepad/:id</td>
<td align="center">Destroy</td>
<td align="center"></td>
</tr>
</tbody>
</table>

<p>Here is a controller that follows the naming convention. Notice
the model name (<strong>note</strong>) matches the view folder (<strong>note/index</strong>). The model does
not need to match the controller because you&rsquo;ll be working with many different
models in your controllers.</p>

<pre><code class="language-go">func Load() {
	...
	// &quot;Get&quot; is the Method
	// &quot;/notepad&quot; is the Path
	router.Get(&quot;/notepad&quot;, Index, acl.DisallowAnon)
	...
}

// Index displays the items.
func Index(w http.ResponseWriter, r *http.Request) {
	c := flight.Context(w, r)

	items, _, err := note.ByUserID(c.DB, c.UserID)
	if err != nil {
		c.FlashError(err)
		items = []note.Item{}
	}

	v := c.View.New(&quot;note/index&quot;)
	v.Vars[&quot;items&quot;] = items
	v.Render(w, r)
}
</code></pre>

<h2 id="access-a-session">Access a Session</h2>

<p>Sessions provide access to flash messages as well as variables that are set at
login. You <strong>must</strong> remember to save the sessions once you make a change to
them.</p>

<pre><code class="language-go">// Get the current session
sess, _ := session.Instance(r)
...
// Save the session after you are finished making changes
sess.Save(r, w)
</code></pre>

<h2 id="trigger-flash-message">Trigger Flash Message</h2>

<p>Flash messages will appear to the user on next page load. They only display
once. The built-in messages are tied to Bootstrap classes:</p>

<ul>
<li>flash.Success is green (alert-success)</li>
<li>flash.Warning is yellow (alert-warning)</li>
<li>flash.Notice is blue (alert-info)</li>
<li>flash.Error is red (alert-danger)</li>
</ul>

<pre><code class="language-go">sess.AddFlash(flash.Info{&quot;Welcome to Blueprint!&quot;, flash.Success})
sess.Save(r, w) // Ensure you save the session after making a change to it
</code></pre>

<h2 id="validate-a-form">Validate a Form</h2>

<p>The <strong>form</strong> package makes it easy to validate required fields. It works on the
inputs: text, textarea, checkbox, radio, and select. The function,
<strong>form.Required()</strong>, requires the request and then any number of fields
as it is a variadic function. You can use the <code>form</code> package by itself it you
want more control over the error message or you can use the <code>flight</code> package
which handles the error message for you:</p>

<pre><code class="language-go">// Without flight
if valid, missingField := form.Required(r, &quot;email&quot;, &quot;password&quot;); !valid {
	sess.AddFlash(flash.Info{&quot;Field missing: &quot; + missingField, flash.Error})
	sess.Save(r, w)
	LoginGET(w, r)
	return
}

// With flight
c := flight.Context(w, r)
if !c.FormValid(&quot;name&quot;, &quot;email&quot;, &quot;password&quot;) {
	Create(w, r)
	return
}
</code></pre>

<h2 id="repopulate-form-fields">Repopulate Form Fields</h2>

<p>The <strong>form</strong> package can also repopulate the form fields after a submission that
is missing information. It is also a
variadic function so it can accepts more than one field. You&rsquo;ll need to use
blocks from the <strong>form</strong> package in your view as well. Check out the
<a href="http://blue-jay.github.io/views/#repopulate-form-fields">Views</a> page to see how to use them.</p>

<pre><code class="language-go">// Without flight
c := flight.Context(w, r)
v := c.View.New(&quot;note/create&quot;)
form.Repopulate(r.Form, v.Vars, &quot;name&quot;)
v.Render(w, r)

// With flight
c := flight.Context(w, r)
v := c.View.New(&quot;note/create&quot;)
c.Repopulate(v.Vars, &quot;name&quot;)
v.Render(w, r)
</code></pre>

<h2 id="render-a-template">Render a Template</h2>

<p>You can render a template a few ways (check out the <a href="http://blue-jay.github.io/views">Views</a>
page for more clarification):</p>

<pre><code class="language-go">// Render without adding any variables
c := flight.Context(w, r)
c.View.New(&quot;about/index&quot;).Render(w, r)

// Render with variables
c := flight.Context(w, r)
v := c.View.New(&quot;home/index&quot;)
v.Vars[&quot;first_name&quot;] = c.Sess.Values[&quot;first_name&quot;]
v.Render(w, r)

// Render with different base template (base.tmpl is used by default)
c := flight.Context(w, r)
v := c.View.New(&quot;home/index&quot;).Base(&quot;single&quot;)
v.Render(w, r)
</code></pre>

<h2 id="return-flash-over-ajax">Return Flash over Ajax</h2>

<p>If you&rsquo;re using Ajax to retrieve content, you can also retrieve the flash
messages this way so they can be displayed without refreshing the page. There is
JavaScript that is already designed to show a Flash message and it&rsquo;s called:
<strong>ShowFlash()</strong>. You&rsquo;ll just need to make a call to the page and then pass the
output to <strong>ShowFlash()</strong>. The code is below.</p>

<p>Code for the controller:</p>

<pre><code class="language-go">// Load the routes.
func Load() {
	router.Get(&quot;/flashes&quot;, Index)
}

// Index displays the flash messages in JSON.
func Index(w http.ResponseWriter, r *http.Request) {
	c := flight.Context(w, r)

	// Set the flash message
	c.Sess.AddFlash(flash.Info{&quot;An error occurred on the server. Please try again later.&quot;, flash.Error})
	c.Sess.Save(r, w)

	// Display the flash messages as JSON
	flash.SendFlashes(w, r)
}
</code></pre>

<p>Code in JavaScript:</p>

<pre><code class="language-javascript">$.get(&quot;/flashes&quot;, function(data) {
	showFlash(data);
});
</code></pre>

<h2 id="interact-with-a-model">Interact with a Model</h2>

<p>The models contain all the SQL code so the controllers just call the model
functions to interact with the data.</p>

<pre><code class="language-go">// Get database result
result, norows, err := user.ByEmail(email)

if nowrows {
	// User does not exist
} else if err != nil {
	// Display error message
} else if passhash.MatchString(result.Password, password) {
	// Password matches!
} else {
	// Password does not match
}
</code></pre>

<h2 id="send-an-email">Send an Email</h2>

<p>There is also a simple package that sends emails once the SMTP settings in
env.json point to your SMTP server.</p>

<pre><code class="language-go">// Email a user
c := flight.Context(w, r)
err := c.Config.Email.Send(&quot;This is the subject&quot;, &quot;This is the body!&quot;)
if err != nil {
	c.FlashError(err)
	return
}
</code></pre>

			
			<aside class="copyright" role="note">
				
				&copy; 2016 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">
					Material
				</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="http://blue-jay.github.io/middleware/" title="Middleware">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Middleware
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="http://blue-jay.github.io/models/" title="Models">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Models
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'http:\/\/blue-jay.github.io\/';
      var repo_id  = 'blue-jay\/blueprint';
    
    </script>

    <script src="http://blue-jay.github.io/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(headers.length > 0) {
        for(var i = 0; i < headers.length; i++) {
          var li = document.createElement("li");
          li.setAttribute("class", "anchor");

          var a  = document.createElement("a");
          a.setAttribute("href", "#" + headers[i].id);
          a.setAttribute("title", headers[i].innerHTML);
          a.innerHTML = headers[i].innerHTML;
          
          li.appendChild(a)
          scrollspy.appendChild(li);
        }
      } else {
        scrollspy.parentElement.removeChild(scrollspy)
      }
      

      /* Add permanent link next to the headers */
      var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

      for(var i = 0; i < headers.length; i++) {
          var a = document.createElement("a");
          a.setAttribute("class", "headerlink");
          a.setAttribute("href", "#" + headers[i].id);
          a.setAttribute("title", "Permanent link")
          a.innerHTML = "#";
          headers[i].appendChild(a);
      }
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-80295457-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="//gohugo.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>